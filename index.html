<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>智能线路跳转中</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg1: #1d2671;
  --bg2: #c33764;
  --card-bg: rgba(255,255,255,.15);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  height: 100vh;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
}

.card {
  width: 90%;
  max-width: 420px;
  background: var(--card-bg);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  padding: 32px 24px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.25);
}

h1 {
  margin: 0 0 12px;
  font-size: 22px;
}

.status {
  font-size: 15px;
  opacity: .9;
  margin-bottom: 24px;
}

.loader {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(255,255,255,.3);
  border-top-color: #fff;
  border-radius: 50%;
  margin: 0 auto 20px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.footer {
  font-size: 12px;
  opacity: .6;
  margin-top: 20px;
}
</style>
</head>

<body>

<div class="card">
  <div class="loader"></div>
  <h1>正在选择最佳线路</h1>
  <div class="status" id="status">线路检测中，请稍候…</div>
  <div class="footer">系统将自动为您匹配最优访问节点</div>
</div>

<script>
/* ===== 配置 ===== */
const LINK_JSON_URL = "https://你的JSON地址/links.json";
const DEFAULT_TIMEOUT = 3000;

/* ===== 工具 ===== */
function isMobile() {
  return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}

function testLink(url, timeout) {
  return new Promise(resolve => {
    const start = performance.now();
    const controller = new AbortController();
    const timer = setTimeout(() => controller.abort(), timeout);

    fetch(url, {
      method: "HEAD",
      mode: "no-cors",
      signal: controller.signal
    }).then(() => {
      clearTimeout(timer);
      resolve({
        url,
        time: performance.now() - start
      });
    }).catch(() => resolve(null));
  });
}

/* ===== 主逻辑 ===== */
async function start() {
  const status = document.getElementById("status");

  try {
    const res = await fetch(LINK_JSON_URL + "?t=" + Date.now());
    const data = await res.json();

    const timeout = data.timeout || DEFAULT_TIMEOUT;
    const mobile = isMobile();

    const candidates = data.links.filter(l =>
      mobile ? l.mobile : l.pc
    );

    if (!candidates.length) {
      status.innerText = "暂无适合当前设备的线路";
      return;
    }

    status.innerText = "正在并发检测线路速度…";

    const tasks = candidates.map(l => testLink(l.url, timeout));
    const results = (await Promise.all(tasks)).filter(Boolean);

    if (!results.length) {
      status.innerText = "所有线路暂时不可用";
      return;
    }

    results.sort((a, b) => a.time - b.time);
    const best = results[0];

    status.innerText = "已选择最优线路，正在跳转…";

    setTimeout(() => {
      location.href = best.url;
    }, 600);

  } catch (e) {
    status.innerText = "系统异常，请稍后重试";
  }
}

start();
</script>

</body>
</html>
